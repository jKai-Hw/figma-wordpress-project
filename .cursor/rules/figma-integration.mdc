---
description: Figma MCP連携ルール
globs: "**/*"
alwaysApply: true
---

# Figma MCP連携ガイドライン

> Figma MCPを使ってデザインを実装する際のルールとプロンプトテンプレート

## 前提
- デザインは別のデザイナーさんが作成
- 自分はコーディング担当
- Figmaデザインは変更しない（参照のみ）
- **Figma Dev Mode + MCP** を活用

---

## ⚡ API使用量の最適化（重要）

### 基本方針
- **必要なときだけ取得**: 同じ情報を何度も取得しない
- **キャッシュを活用**: 取得した情報はメモに残す
- **効率的な指示**: AIへの指示を明確にし、やり直しを減らす

### Figma MCP 最適化ルール

#### 1. 取得タイミングの最小化
```
❌ 避ける: セクションごとに毎回ページ全体を取得
✅ 推奨: 最初に1回だけ全体を取得 → 情報をメモ → セクション実装時はメモを参照
```

#### 2. 取得情報のキャッシュ（メモ）
最初にFigmaから取得したら、以下をメモとして残す：

```markdown
## デザインメモ（API取得結果）

### カラーパレット
- Primary: #3B82F6
- Secondary: #10B981
- Text: #1F2937
- Background: #FFFFFF

### フォント
- 見出し: Noto Sans JP / Bold / 32px（PC）, 24px（SP）
- 本文: Noto Sans JP / Regular / 16px / line-height: 1.75

### スペーシング
- セクション間: 80px（PC）, 48px（SP）
- 要素間: 24px

### セクション構成
1. Header
2. Hero（メインビジュアル）
3. About（会社概要）
4. Service（サービス一覧）
5. News（お知らせ）
6. Contact（CTA）
7. Footer
```

#### 3. Node ID の活用
Figma MCPでは **Node ID** を指定して特定の要素だけを取得できる。
- FigmaのURLから `node-id` パラメータを確認
- 必要なセクションのNode IDだけを指定して取得

### Cursor AI 最適化ルール

#### 1. 明確な指示を出す
```
❌ 曖昧: 「いい感じにして」「きれいにして」
✅ 明確: 「ヒーローセクションのSCSSを作成。変数は_variables.scssを使用」
```

#### 2. 出力形式を指定
```
❌ 長い: 「説明も含めて詳しく」→ トークン消費大
✅ 簡潔: 「コードのみ出力」「変更点のみ説明」
```

#### 3. バッチ処理
```
❌ 非効率: 1ファイルずつ順番に依頼
✅ 効率的: 「以下の3ファイルを作成してください」とまとめて依頼
```

---

## 🪄 プロンプトテンプレート集

### フェーズ1: 構造解析（最初の1回だけ）

#### 1-1. ページ構成の取得
```markdown
@Figma
このプロジェクトのファイル構造を解析してください。
デザインの詳細（色や座標）は一切不要です。
以下の情報をリストアップしてください：

1. 全ページの名称（Top, About, Serviceなど）
2. ページ間の階層構造
3. 共通コンポーネント（ヘッダー、フッター、ボタン等）の有無

出力は簡潔なリスト形式でお願いします。
```

#### 1-2. WordPressアーキテクチャ設計
```markdown
上記で取得したページ構成に基づき、WordPressアーキテクチャを設計してください。

出力形式：
1. **カスタム投稿タイプ:** (スラッグと用途)
2. **タクソノミー:** (カテゴリー・タグ設計)
3. **ACFフィールド:** (必要なページとフィールド概略)
4. **テンプレート階層:** (作成すべきファイル一覧)
```

---

### フェーズ2: デザイントークン抽出（最初の1回だけ）

#### 2-1. SCSS変数の生成
```markdown
@Figma
デザインのスタイルガイド（Colors / Typography）を読み取ってください。

以下のSCSS変数を `_variables.scss` 形式で出力してください：
- カラーパレット（$color-primary, $color-text 等）
- フォントファミリー
- フォントサイズ（$font-size-base, $font-size-lg 等）
- スペーシング（$spacing-sm, $spacing-md 等）
- ブレークポイント

出力はコードのみでお願いします。
```

---

### フェーズ3: セクション実装（繰り返し）

#### 3-1. HTML + SCSS 実装
```markdown
@Figma
Node ID: [ここにセクションのID] の情報を取得してください。

この情報を元に、以下を実装してください：

**ファイル:**
1. HTML: `patterns/[セクション名].html`（WordPressブロックパターン形式）
2. SCSS: `assets/scss/sections/_[セクション名].scss`

**要件:**
- BEM記法を使用（.block__element--modifier）
- 色・フォントは `_variables.scss` の変数を使用（ハードコード禁止）
- レスポンシブ対応（SP/PC）を含める
- 画像はプレースホルダー使用可
- セマンティックなHTML構造（section, h2, ul/li 等）
```

#### 3-2. ヘッダー/フッター実装
```markdown
@Figma
ヘッダー（またはフッター）のデザイン情報を取得してください。

以下を実装してください：

**ファイル:**
1. HTML: `parts/header.html`（WordPressテンプレートパーツ）
2. SCSS: `assets/scss/sections/_header.scss`

**要件:**
- ロゴはトップページへのリンク
- ナビゲーションは `<!-- wp:navigation -->` を使用
- SP時はハンバーガーメニュー化
- BEM記法、変数使用を徹底
```

---

### フェーズ4: 動的化（ACF連携）

#### 4-1. ACFフィールド設計
```markdown
@Figma
この [セクション名] のデザインを見てください。

動的に変更すべき箇所を特定し、以下を出力してください：
1. ACFフィールドグループ設計（フィールド名、タイプ、用途）
2. PHPでの出力コード（get_field使用、エスケープ処理込み）

**要件:**
- フィールド名は英語スネークケース
- 出力時は必ず esc_html(), esc_url() を使用
- 繰り返し要素は have_rows() を使用
```

#### 4-2. ループ処理の実装
```markdown
この [セクション名] を動的に変更します。

**要件:**
1. テキスト・画像を ACF の get_field() に置き換え
2. 繰り返し要素は have_rows() または WP_Query を使用
3. 出力時は必ずエスケープ処理（esc_html, esc_url, esc_attr）

セキュリティを最優先してください。
```

---

### フェーズ5: 品質チェック

#### 5-1. コードレビュー
```markdown
今回作成したファイルについて、以下をチェックしてください：

チェック項目：
- [ ] BEM命名規則は正しいか？
- [ ] 色・フォントサイズのハードコードはないか？
- [ ] 変数が正しく使われているか？
- [ ] レスポンシブ対応は適切か？
- [ ] エスケープ処理は漏れていないか？

問題がある場合は修正案を提示してください。
```

---

## 🔄 ワークフロー全体像

```
【Phase 1】構造把握（API取得: 1回）
├── Figma MCPでページ構成を取得
├── セクションリストをメモに記録
└── WordPress設計（CPT, テンプレート）を決定

【Phase 2】ベース構築（API取得: 1回）
├── デザイントークン（カラー、フォント）を取得
├── _variables.scss 作成
└── theme.json 設定

【Phase 3】セクション実装（API取得: 必要な場合のみ）
├── メモを参照してコード生成
├── 詳細が不明な場合のみNode ID指定で取得
├── HTML + SCSS をセットで作成
└── 次のセクションへ

【Phase 4】動的化
├── ACFフィールド設計
├── PHP出力コード作成
└── ループ処理実装

【Phase 5】品質チェック
├── AIによるコードレビュー
├── 人間による目視確認
└── レスポンシブテスト
```

---

## デザイントークンの変換

### カラー → SCSS変数 + theme.json
```scss
// _variables.scss
$color-primary: #3B82F6;
$color-secondary: #10B981;
$color-text: #1F2937;
$color-background: #FFFFFF;
```

```json
// theme.json
{
  "settings": {
    "color": {
      "palette": [
        { "slug": "primary", "color": "#3B82F6", "name": "Primary" },
        { "slug": "secondary", "color": "#10B981", "name": "Secondary" }
      ]
    }
  }
}
```

### タイポグラフィ → SCSS変数 + theme.json
```scss
// _variables.scss
$font-family-base: 'Noto Sans JP', sans-serif;
$font-size-base: 1rem;
$font-size-lg: 1.25rem;
$line-height-base: 1.75;
```

### スペーシング → SCSS変数 + theme.json
```scss
// _variables.scss
$spacing-sm: 1rem;
$spacing-md: 1.5rem;
$spacing-lg: 2rem;
```

---

## 実装優先順位
1. デザイントークン抽出・変数定義
2. グローバルスタイル（theme.json + _base.scss）
3. ヘッダー/フッター（parts/）
4. 共通コンポーネント（components/）
5. セクション/パターン（patterns/）
6. 個別テンプレート（templates/）

---

## デザイナーへの確認が必要なケース
以下の場合は、実装前にユーザーに確認を促す：
- デザインに曖昧な部分がある
- レスポンシブ時の挙動が不明
- ホバー状態のデザインがない
- 実装上の都合でデザインの調整が必要
