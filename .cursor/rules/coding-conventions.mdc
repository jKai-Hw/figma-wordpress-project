---
description: コーディング規約・レスポンシブ実装ルール
globs:
  - "**/*.php"
  - "**/*.scss"
  - "**/*.js"
  - "**/*.html"
alwaysApply: false
---

# コーディング規約

## 🎯 基本原則

- **可読性優先**: 他の人が読んでも理解できるコード
- **一貫性**: プロジェクト全体で同じスタイルを維持
- **モバイルファースト**: ベースをSPで書き、大きい画面に向けて拡張

---

## 💰 トークン節約・AI最適化

AIのコンテキスト制限（トークン）を節約し、推論精度を上げるためのルール。

### 1. リファレンスの活用
スタイルや変数を実装する際は、まず以下の **[開発リファレンス]** セクションを確認すること。
ここにプロジェクトの変数一覧、Mixin、共通クラスがまとめられている。

### 2. ファイル読み込み範囲の制限
巨大なファイルを編集する際は、`Read` ツールの `start_line` / `limit` (または `end_line`) を活用し、**必要な箇所だけ** を読み込むこと。

- ❌ NG: `style.css` 全体を読む
- ✅ OK: `style.css` のヘッダー部分（100行目付近）だけ読む

### 3. コミットの粒度
「1つの変更」ごとにこまめにコミットし、Gitの状態をクリーンに保つ。これにより `git diff` の出力が減り、現状把握のトークン消費が抑えられる。

---

## 📚 開発リファレンス (Context Map)

AI参照用の軽量ドキュメント。スタイリングやPHP実装時はまずここを参照。

### 🎨 SCSS変数 (`_variables.scss`)

#### Colors
| 変数名 | 値 | 用途 |
|---|---|---|
| `$color-primary` | `#8EB03B` | メインカラー（緑） |
| `$color-accent` | `#F7B560` | アクセントカラー（オレンジ） |
| `$color-text` | `#333333` | 基本テキスト |
| `$color-text-light` | `#666666` | 薄いテキスト |
| `$color-light` | `#FAFAF8` | 背景色（薄いベージュ） |
| `$color-white` | `#FFFFFF` | 白 |
| `$color-border` | `#E0E0E0` | ボーダー色 |

#### Breakpoints
| 変数名 | 値 | デバイス |
|---|---|---|
| `$breakpoint-sm` | `576px` | スマホ横など |
| `$breakpoint-md` | `768px` | タブレット・スマホ |
| `$breakpoint-lg` | `992px` | PC小 |
| `$breakpoint-xl` | `1200px` | PC大 |

#### Spacing
| 変数名 | 値 |
|---|---|
| `$spacing-xs` | `8px` |
| `$spacing-sm` | `16px` |
| `$spacing-md` | `24px` |
| `$spacing-lg` | `40px` |
| `$spacing-xl` | `60px` |
| `$spacing-2xl` | `80px` |
| `$spacing-3xl` | `100px` |

### 🛠 SCSS Mixins (`_mixins.scss`)

- **`@include mq($breakpoint)`**: min-width (PC firstの逆、SP first用)
- **`@include mq-max($breakpoint)`**: max-width (PCデザインをSPに適用する時など)
- **`@include container`**: 中央寄せコンテナ
- **`@include flex-center`**: 上下左右中央寄せ

### 📂 ディレクトリ構造（主要部分のみ）

```
wp-theme/
├── assets/
│   ├── scss/
│   │   ├── _variables.scss
│   │   ├── _mixins.scss
│   │   ├── components/ (_button.scss, _card.scss)
│   │   └── sections/ (_hero.scss, _about.scss, ...)
│   └── img/
├── template-parts/ (予定)
└── front-page.php (予定)
```

---

## 📐 インデント・フォーマット

| 項目 | 設定 |
|------|------|
| インデント | **スペース2つ** |
| 行末スペース | 削除 |
| ファイル末尾 | 空行1つ |
| 最大行長 | 120文字（目安） |

---

## 📛 命名規則

### ファイル名
| 種類 | 形式 | 例 |
|------|------|-----|
| SCSS | `_kebab-case.scss` | `_hero-section.scss` |
| PHP | `kebab-case.php` | `custom-post-types.php` |
| JS | `kebab-case.js` | `slider-init.js` |

### CSS/SCSSクラス名（BEM記法）
```scss
// Block
.card { }

// Element（__で接続）
.card__image { }
.card__title { }

// Modifier（--で接続）
.card--featured { }

// JavaScript用（js-接頭辞）
.js-slider { }
```

---

## 💬 コメントルール

### SCSS
```scss
// ============================================
// セクション区切り（大見出し）
// ============================================

// 単一行コメント（説明）
.component {
  width: calc(100% - 40px); // 左右20pxずつの余白を引く
}
```

### PHP
```php
/**
 * 関数の説明
 *
 * @param int $post_id 投稿ID
 * @return string|false 画像URL
 */
function theme_get_thumbnail_url( $post_id ) {
  return get_the_post_thumbnail_url( $post_id, 'large' );
}
```

---

## 📱 レスポンシブ設計

### モバイルファーストの書き方
```scss
// ✅ 正しい書き方
.section {
  padding: $spacing-md;  // ベース: SP
  
  @include tablet-up {
    padding: $spacing-lg;
  }
  
  @include pc {
    padding: $spacing-xl;
  }
}
```

---

## 🚫 アンチパターン

```scss
// ❌ 避ける
#header { }           // IDセレクタ
div.card { }          // 不要な要素セレクタ
!important            // 極力避ける

// ✅ 推奨
.header { }
.card { }
```

```php
// ❌ 避ける
echo $var;                    // エスケープなし

// ✅ 推奨
echo esc_html( $var );
```

---

## ✅ コミット前チェック

- [ ] インデントは統一されているか（スペース2つ）
- [ ] 命名規則に従っているか
- [ ] console.log / var_dump は削除したか
- [ ] PHPの出力はエスケープしているか
